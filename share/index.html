<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WakeMedi Share</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const params = new URLSearchParams(window.location.search);
      const data = params.get("data") || "";

      // 1. App Link URL (https)
      const appLinkUrl = `https://journey-min-79.github.io/wakemedi-links/share?data=${encodeURIComponent(data)}`;

      // 2. Custom Scheme URL
      const schemeUrl = `wakemedi://share?data=${encodeURIComponent(data)}`;

      // 3. 스토어 fallback
      const playStoreUrl = "https://play.google.com/store/apps/details?id=com.example.wakemedi";
      const appStoreUrl = "https://apps.apple.com/app/idYOUR_APP_ID";
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      let fallbackUrl = playStoreUrl;
      if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
        fallbackUrl = appStoreUrl;
      }

      // 앱 실행 시도 → 우선 스킴
      window.location.href = schemeUrl;

      // 앱이 열렸는지 감지
      let hidden = false;
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) hidden = true; // 앱으로 전환됨
      });

      // 2초 뒤 앱이 안 열렸으면 → 스토어로
      setTimeout(() => {
        if (!hidden) {
          window.location.href = fallbackUrl;
        }
      }, 3000);
    });
  </script>
</head>
<body>
  <h2>WakeMedi 공유 링크</h2>
  <p>앱으로 이동 중입니다...</p>
  <p>자동으로 열리지 않으면 <a id="manualLink">여기</a>를 눌러주세요.</p>
  <script>
    document.getElementById("manualLink").href = "wakemedi://share?data=" + encodeURIComponent(new URLSearchParams(window.location.search).get("data") || "");
  </script>
</body>
</html>
